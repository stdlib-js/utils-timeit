{"version":3,"file":"index.mjs","sources":["../lib/validate.js","../lib/context.js","../lib/async.js","../lib/sync.js","../lib/wrap.js","../lib/vm_compile.js","../lib/vm_evaluate.js","../lib/min_time.js","../lib/transform.js","../lib/timeit.js","../lib/index.js"],"sourcesContent":["/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar isObject = require( '@stdlib/assert-is-plain-object' );\nvar hasOwnProp = require( '@stdlib/assert-has-own-property' );\nvar isPositiveInteger = require( '@stdlib/assert-is-positive-integer' ).isPrimitive;\nvar isString = require( '@stdlib/assert-is-string' ).isPrimitive;\nvar isBoolean = require( '@stdlib/assert-is-boolean' ).isPrimitive;\nvar isNull = require( '@stdlib/assert-is-null' );\nvar format = require( '@stdlib/string-format' );\n\n\n// MAIN //\n\n/**\n* Validates function options.\n*\n* @private\n* @param {Object} opts - destination object\n* @param {Options} options - options to validate\n* @param {string} [options.before] - setup code\n* @param {string} [options.after] - cleanup code\n* @param {(PositiveInteger|null)} [options.iterations] - number of iterations\n* @param {PositiveInteger} [options.repeats] - number of repeats\n* @param {boolean} [options.asynchronous] - boolean indicating whether a snippet is asynchronous\n* @returns {(Error|null)} error or null\n*\n* @example\n* var opts = {};\n* var options = {\n*     'iterations': 1e7,\n*     'repeats': 5\n* };\n* var err = validate( opts, options );\n* if ( err ) {\n*     throw err;\n* }\n*/\nfunction validate( opts, options ) {\n\tif ( !isObject( options ) ) {\n\t\treturn new TypeError( format( 'invalid argument. Options argument must be an object. Value: `%s`.', options ) );\n\t}\n\tif ( hasOwnProp( options, 'iterations' ) ) {\n\t\topts.iterations = options.iterations;\n\t\tif (\n\t\t\t!isPositiveInteger( opts.iterations ) &&\n\t\t\t!isNull( opts.iterations )\n\t\t) {\n\t\t\treturn new TypeError( format( 'invalid option. `%s` option must be a positive integer or null. Option: `%s`.', 'iterations', opts.iterations ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'repeats' ) ) {\n\t\topts.repeats = options.repeats;\n\t\tif ( !isPositiveInteger( opts.repeats ) ) {\n\t\t\treturn new TypeError( format( 'invalid option. `%s` option must be a positive integer. Option: `%s`.', 'repeats', opts.repeats ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'before' ) ) {\n\t\topts.before = options.before;\n\t\tif ( !isString( opts.before ) ) {\n\t\t\treturn new TypeError( format( 'invalid option. `%s` option must be a string. Option: `%s`.', 'before', opts.before ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'after' ) ) {\n\t\topts.after = options.after;\n\t\tif ( !isString( opts.after ) ) {\n\t\t\treturn new TypeError( format( 'invalid option. `%s` option must be a string. Option: `%s`.', 'after', opts.after ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'asynchronous' ) ) {\n\t\topts.asynchronous = options.asynchronous;\n\t\tif ( !isBoolean( opts.asynchronous ) ) {\n\t\t\treturn new TypeError( format( 'invalid option. `%s` option must be a boolean. Option: `%s`.', 'asynchronous', opts.asynchronous ) );\n\t\t}\n\t}\n\treturn null;\n}\n\n\n// EXPORTS //\n\nmodule.exports = validate;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar defineProperty = require( '@stdlib/utils-define-property' );\nvar tic = require( '@stdlib/time-tic' );\nvar toc = require( '@stdlib/time-toc' );\n\n\n// MAIN //\n\n/**\n* Returns a context.\n*\n* @private\n* @param {Callback} done - callback to be invoked within snippet execution context\n* @returns {Object} context\n*/\nfunction context( done ) {\n\tvar ctx = {};\n\n\tdefineProperty( ctx, 'tic', {\n\t\t'configurable': false,\n\t\t'enumerable': false,\n\t\t'writable': false,\n\t\t'value': tic\n\t});\n\tdefineProperty( ctx, 'toc', {\n\t\t'configurable': false,\n\t\t'enumerable': false,\n\t\t'writable': false,\n\t\t'value': toc\n\t});\n\tdefineProperty( ctx, 'done', {\n\t\t'configurable': false,\n\t\t'enumerable': false,\n\t\t'writable': false,\n\t\t'value': done\n\t});\n\treturn {\n\t\t'tic': tic,\n\t\t'toc': toc,\n\t\t'done': done\n\t};\n}\n\n\n// EXPORTS //\n\nmodule.exports = context;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// VARIABLES //\n\nvar noop = 'next();';\n\n\n// MAIN //\n\n/**\n* Generates a source code body for asynchronous execution.\n*\n* ## Notes\n*\n* -   Example output:\n*\n*     ```javascript\n*     \"use strict\";\n*\n*     var ctx = this;\n*     var state1 = {};\n*     var t1, d1, i1;\n*\n*     function before( state, next ) {\n*         // {{before}}\n*     }\n*\n*     function cb1( error ) {\n*         if ( error ) {\n*             return ctx.done( error );\n*         }\n*         i1 = 0;\n*         t1 = ctx.tic();\n*         main( state1, cb2 );\n*     }\n*\n*     function main( state, next ) {\n*         // {{code}}\n*     }\n*\n*     function cb2( error ) {\n*         if ( error ) {\n*             return ctx.done( error );\n*         }\n*         i1 += 1;\n*         if ( i1 < 1e6 ) {\n*             return main( state1, cb2 );\n*         }\n*         d1 = ctx.toc( t1 );\n*         after( state1, cb3 );\n*     }\n*\n*     function after( state, next ) {\n*         // {{after}}\n*     }\n*\n*     function cb3( error ) {\n*         if ( error ) {\n*             return ctx.done( error );\n*         }\n*         ctx.done( null, d1 );\n*     }\n*\n*     before( state1, cb1 );\n*\n*     return 1;\n*     ```\n*\n*\n* @private\n* @param {number} id - id\n* @param {string} code - code to time\n* @param {Options} opts - function options\n* @param {string} opts.before - setup code\n* @param {string} opts.after - cleanup code\n* @param {PositiveInteger} opts.iterations - number of iterations\n* @returns {string} source code body\n*/\nfunction body( id, code, opts ) {\n\tvar before;\n\tvar after;\n\tvar state;\n\tvar main;\n\tvar src;\n\tvar cb1;\n\tvar cb2;\n\tvar cb3;\n\tvar ctx;\n\tvar t;\n\tvar d;\n\tvar i;\n\n\tsrc = '\"use strict\";';\n\n\t// Define identifiers:\n\tbefore = '__before$'+id+'__';\n\tafter = '__after$'+id+'__';\n\tstate = '__state$'+id+'__';\n\tmain = '__main$'+id+'__';\n\tcb1 = '__cb1$'+id+'__';\n\tcb2 = '__cb2$'+id+'__';\n\tcb3 = '__cb3$'+id+'__';\n\tctx = '__ctx$'+id+'__';\n\ti = '__i$'+id+'__';\n\tt = '__t$'+id+'__';\n\td = '__d$'+id+'__';\n\n\t// Declare variables:\n\tsrc += 'var '+ctx+' = this;';\n\tsrc += 'var '+state+' = {};';\n\tsrc += 'var '+i+','+t+','+d+';';\n\n\t// Insert the setup code:\n\tsrc += 'function '+before+'( state, next ) {';\n\tsrc += '  '+(opts.before||noop)+';';\n\tsrc += '}';\n\n\t// Insert the setup callback:\n\tsrc += 'function '+cb1+'( error ) {';\n\tsrc += '  if ( error ) {';\n\tsrc += '    return '+ctx+'.done( error );';\n\tsrc += '  }';\n\tsrc += '  '+i+' = 0;';\n\tsrc += '  '+t+' = '+ctx+'.tic();'; // start the timer\n\tsrc += '  '+main+'( '+state+','+cb2+' );';\n\tsrc += '}';\n\n\t// Wrap the code to time in a function:\n\tsrc += 'function '+main+'( state, next ) {';\n\tsrc += '  '+(code||noop)+';';\n\tsrc += '}';\n\n\t// Insert the main callback:\n\tsrc += 'function '+cb2+'( error ) {';\n\tsrc += '  if ( error ) {';\n\tsrc += '    return '+ctx+'.done( error );';\n\tsrc += '  }';\n\tsrc += '  '+i+' += 1;';\n\tsrc += '  if ( '+i+' < '+opts.iterations+' ) {';\n\tsrc += '    return '+main+'( '+state+','+cb2+' );';\n\tsrc += '  }';\n\tsrc += '  '+d+' = '+ctx+'.toc( '+t+' );'; // stop the timer\n\tsrc += '  '+after+'( '+state+','+cb3+' );';\n\tsrc += '}';\n\n\t// Insert the cleanup code:\n\tsrc += 'function '+after+'( state, next ) {';\n\tsrc += '  '+(opts.after||noop)+';';\n\tsrc += '}';\n\n\t// Insert the cleanup callback:\n\tsrc += 'function '+cb3+'( error ) {';\n\tsrc += '  if ( error ) {';\n\tsrc += '    return '+ctx+'.done( error );';\n\tsrc += '  }';\n\tsrc += '  '+ctx+'.done( null,'+d+' );'; // return results\n\tsrc += '}';\n\n\t// Invoke the setup function to begin the execution sequence:\n\tsrc += before+'( '+state+','+cb1+' );';\n\n\t// Return a value:\n\tsrc += 'return '+id+';';\n\n\treturn src;\n}\n\n\n// EXPORTS //\n\nmodule.exports = body;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MAIN //\n\n/**\n* Generates a source code body for synchronous execution.\n*\n* ## Notes\n*\n* -   Example output:\n*\n*     ```javascript\n*     \"use strict\";\n*\n*     var ctx = this;\n*     var t1, d1, i1;\n*\n*     // {{before}}\n*\n*     t1 = ctx.tic();\n*     for ( i1 = 0; i1 < 1e6; i1++ ) {\n*         // {{code}}\n*     }\n*     d1 = ctx.toc( t1 );\n*\n*     // {{after}}\n*\n*     ctx.done( null, d1 );\n*\n*     return 1;\n*     ```\n*\n*\n* @private\n* @param {number} id - id\n* @param {string} code - code to time\n* @param {Options} opts - function options\n* @param {string} opts.before - setup code\n* @param {string} opts.after - cleanup code\n* @param {PositiveInteger} opts.iterations - number of iterations\n* @returns {string} source code body\n*/\nfunction generate( id, code, opts ) {\n\tvar src;\n\tvar ctx;\n\tvar t;\n\tvar d;\n\tvar i;\n\n\tsrc = '\"use strict\";';\n\n\t// Declare variables:\n\tctx = '__ctx$'+id+'__';\n\ti = '__i$'+id+'__';\n\tt = '__t$'+id+'__';\n\td = '__d$'+id+'__';\n\n\tsrc += 'var '+ctx+' = this;';\n\tsrc += 'var '+t+','+d+','+i+';';\n\n\t// Insert the setup code:\n\tsrc += opts.before+';';\n\n\t// Start the timer:\n\tsrc += t+' = '+ctx+'.tic();';\n\n\t// Create the loop:\n\tsrc += 'for ( '+i+'= 0; '+i+' < '+opts.iterations+'; '+i+'++ ) {';\n\n\t// Insert the loop body:\n\tsrc += code+';';\n\n\t// Close the loop:\n\tsrc += '}';\n\n\t// Stop the timer:\n\tsrc += d+' = '+ctx+'.toc( '+t+' );';\n\n\t// Insert the cleanup code:\n\tsrc += opts.after+';';\n\n\t// Return results:\n\tsrc += ctx+'.done( null, '+d+' );';\n\n\t// Return a value:\n\tsrc += 'return '+id+';';\n\n\treturn src;\n}\n\n\n// EXPORTS //\n\nmodule.exports = generate;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n/**\n* Wraps a source code string similar to `require`.\n*\n* @private\n* @param {string} src - source code\n* @returns {string} wrapped code\n*/\nfunction wrap( src ) {\n\tvar out = '';\n\tout += '(function(require,__filename,__dirname){';\n\tout += src;\n\tout += '});';\n\treturn out;\n}\n\n\n// EXPORTS //\n\nmodule.exports = wrap;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar vm = require( 'vm' );\nvar wrap = require( './wrap.js' );\n\n\n// MAIN //\n\n/**\n* Compiles JavaScript source code for execution within a V8 virtual machine context.\n*\n* @private\n* @param {string} filename - filename to associate with compiled source code\n* @param {string} code - source code to compile\n* @returns {Function} compiled source code wrapped within a function\n*/\nfunction compile( filename, code ) {\n\tvar script;\n\tvar opts;\n\n\t// Wrap the source code similar to `require`:\n\tcode = wrap( code );\n\n\t// Compile the source code:\n\topts = {\n\t\t'filename': filename,\n\t\t'lineOffset': 0\n\t};\n\tscript = new vm.Script( code, opts );\n\n\t// Run the compiled code in the current V8 context:\n\topts = {\n\t\t'displayErrors': true\n\t};\n\treturn script.runInThisContext( opts );\n}\n\n\n// EXPORTS //\n\nmodule.exports = compile;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar minstd = require( '@stdlib/random-base-minstd-shuffle' );\nvar createContext = require( './context.js' );\nvar asyncSource = require( './async.js' );\nvar syncSource = require( './sync.js' );\nvar compile = require( './vm_compile.js' );\n\n\n// MAIN //\n\n/**\n* Evaluates source code within a V8 virtual machine context.\n*\n* @private\n* @param {string} src - source code\n* @param {Object} opts - options\n* @param {string} filename - filename\n* @param {string} dirname - directory name\n* @param {Callback} clbk - callback to invoke upon completion\n* @returns {void}\n*/\nfunction evaluate( src, opts, filename, dirname, clbk ) {\n\tvar context;\n\tvar tmp;\n\tvar fcn;\n\tvar err;\n\tvar id;\n\n\t// Create an id:\n\tid = minstd();\n\n\t// Create an execution context:\n\tcontext = createContext( done );\n\n\t// Generate the source code to evaluate...\n\tif ( opts.asynchronous ) {\n\t\tsrc = asyncSource( id, src, opts );\n\t} else {\n\t\tsrc = syncSource( id, src, opts );\n\t}\n\t// Compile the source code:\n\tfcn = compile( filename, src );\n\n\t// Execute the source code:\n\ttmp = fcn.call( context, require, filename, dirname );\n\n\t// Check that the snippet did not prematurely return...\n\tif ( tmp !== id ) {\n\t\terr = new Error( 'evaluation error. Unable to retrieve evaluation results. Ensure that the provided snippet does not return prematurely.' );\n\t\treturn done( err );\n\t}\n\t/**\n\t* Callback invoked upon executing source code.\n\t*\n\t* @private\n\t* @param {(Error|null)} error - error object\n\t* @param {NonNegativeIntegerArray} results - results\n\t* @returns {void}\n\t*/\n\tfunction done( error, results ) {\n\t\tif ( error ) {\n\t\t\treturn clbk( error );\n\t\t}\n\t\treturn clbk( null, results );\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = evaluate;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MAIN //\n\n/**\n* Computes the minimum time.\n*\n* @private\n* @param {ArrayArray} times - times\n* @returns {NonNegativeIntegerArray} minimum time\n*/\nfunction min( times ) {\n\tvar out;\n\tvar t;\n\tvar i;\n\n\tout = times[ 0 ];\n\tfor ( i = 1; i < times.length; i++ ) {\n\t\tt = times[ i ];\n\t\tif (\n\t\t\tt[ 0 ] < out[ 0 ] ||\n\t\t\t(\n\t\t\t\tt[ 0 ] === out[ 0 ] &&\n\t\t\t\tt[ 1 ] < out[ 1 ]\n\t\t\t)\n\t\t) {\n\t\t\tout = t;\n\t\t}\n\t}\n\treturn out;\n}\n\n\n// EXPORTS //\n\nmodule.exports = min;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar min = require( './min_time.js' );\n\n\n// MAIN //\n\n/**\n* Transforms raw results.\n*\n* @private\n* @param {ArrayArray} raw - raw results\n* @param {PositiveInteger} iterations - number of iterations\n* @returns {Object} transformed results\n*/\nfunction transform( raw, iterations ) {\n\tvar secs;\n\tvar rate;\n\tvar out;\n\tvar m;\n\n\tm = min( raw );\n\tsecs = m[ 0 ] + ( m[ 1 ]/1e9 );\n\trate = iterations / secs;\n\n\tout = {\n\t\t'iterations': iterations,\n\t\t'repeats': raw.length,\n\t\t'min': m,\n\t\t'elapsed': secs,\n\t\t'rate': rate,\n\t\t'times': raw\n\t};\n\treturn out;\n}\n\n\n// EXPORTS //\n\nmodule.exports = transform;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar isString = require( '@stdlib/assert-is-string' ).isPrimitive;\nvar isFunction = require( '@stdlib/assert-is-function' );\nvar isArray = require( '@stdlib/assert-is-array' );\nvar copy = require( '@stdlib/utils-copy' );\nvar cwd = require( '@stdlib/process-cwd' );\nvar format = require( '@stdlib/string-format' );\nvar nextTick = require( '@stdlib/utils-next-tick' );\nvar defaults = require( './defaults.json' );\nvar validate = require( './validate.js' );\nvar evaluate = require( './vm_evaluate.js' );\nvar transform = require( './transform.js' );\n\n\n// VARIABLES //\n\nvar FILENAME = 'timeit.js';\nvar MIN_TIME = 0.1; // seconds\nvar ITERATIONS = 10; // 10^1\nvar MAX_ITERATIONS = 10000000000; // 10^10\n\n\n// MAIN //\n\n/**\n* Times a snippet.\n*\n* @param {string} code - snippet to time\n* @param {Options} [options] - function options\n* @param {string} [options.before=\"\"] - setup code\n* @param {string} [options.after=\"\"] - cleanup code\n* @param {(PositiveInteger|null)} [options.iterations=1e6] - number of iterations\n* @param {PositiveInteger} [options.repeats=3] - number of repeats\n* @param {boolean} [options.asynchronous=false] - boolean indicating whether a snippet is asynchronous\n* @param {Callback} clbk - callback to invoke upon completion\n* @throws {TypeError} first argument must be a string\n* @throws {TypeError} options argument must be an object\n* @throws {TypeError} must provide valid options\n* @throws {TypeError} callback argument must be a function\n* @returns {void}\n*\n* @example\n* var code = '';\n* code += 'var x = Math.pow( Math.random(), 3 );';\n* code += 'if ( x !== x ) {';\n* code += 'throw new Error( \\'Something went wrong.\\' );';\n* code += '}';\n*\n* timeit( code, done );\n*\n* function done( error, results ) {\n*     if ( error ) {\n*         throw error;\n*     }\n*     console.dir( results );\n* }\n*/\nfunction timeit( code, options, clbk ) {\n\tvar results;\n\tvar opts;\n\tvar dir;\n\tvar err;\n\tvar idx;\n\tvar cb;\n\n\tif ( !isString( code ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. First argument must be a string. Value: `%s`.', code ) );\n\t}\n\topts = copy( defaults );\n\tif ( arguments.length === 2 ) {\n\t\tcb = options;\n\t} else {\n\t\tcb = clbk;\n\t\terr = validate( opts, options );\n\t\tif ( err ) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\tif ( !isFunction( cb ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. Callback argument must be a function. Value: `%s`.', cb ) );\n\t}\n\tresults = new Array( opts.repeats );\n\tdir = cwd();\n\tidx = 0;\n\n\t// Pretest to check for early returns and/or errors...\n\ttry {\n\t\tevaluate( code, opts, FILENAME, dir, onTest );\n\t} catch ( error ) {\n\t\terr = new Error( format( 'evaluation error. Encountered an error when evaluating snippet. %s', error.message ) );\n\t\treturn done( err );\n\t}\n\n\t/**\n\t* Evaluates a code snippet on the next turn of the event loop. Waiting until the next turn avoids the current turn being bogged down by a long running queue.\n\t*\n\t* @private\n\t* @param {Callback} clbk - callback\n\t*/\n\tfunction next( clbk ) {\n\t\tnextTick( onTick );\n\n\t\t/**\n\t\t* Callback invoked upon next turn of event loop.\n\t\t*\n\t\t* @private\n\t\t*/\n\t\tfunction onTick() {\n\t\t\tevaluate( code, opts, FILENAME, dir, clbk );\n\t\t}\n\t}\n\n\t/**\n\t* Callback invoked after completing pretest.\n\t*\n\t* @private\n\t* @param {(Error|null)} error - error object\n\t* @param {NonNegativeIntegerArray} time - results\n\t* @returns {void}\n\t*/\n\tfunction onTest( error, time ) {\n\t\tif ( error ) {\n\t\t\treturn done( error );\n\t\t}\n\t\tif ( !isArray( time ) || time.length !== 2 ) {\n\t\t\t// This should only happen if someone is a bad actor and attempts to call the `done` callback without providing timing results.\n\t\t\terror = new Error( 'evaluation error. Did not receive timing results.' );\n\t\t\treturn done( error );\n\t\t}\n\t\tif ( opts.iterations === null ) {\n\t\t\topts.iterations = ITERATIONS;\n\t\t\treturn next( onRun );\n\t\t}\n\t\t// Begin timing the snippet...\n\t\treturn next( onFinish );\n\t}\n\n\t/**\n\t* Callback invoked upon running a pre-run to determine the number of iterations.\n\t*\n\t* @private\n\t* @param {(Error|null)} error - error object\n\t* @param {NonNegativeIntegerArray} time - results\n\t* @returns {void}\n\t*/\n\tfunction onRun( error, time ) {\n\t\tvar t;\n\t\tif ( error ) {\n\t\t\treturn done( error );\n\t\t}\n\t\tt = time[ 0 ] + ( time[ 1 ]/1e9 );\n\t\tif (\n\t\t\tt < MIN_TIME &&\n\t\t\topts.iterations < MAX_ITERATIONS\n\t\t) {\n\t\t\topts.iterations *= 10;\n\t\t\treturn next( onRun );\n\t\t}\n\t\t// Begin timing the snippet...\n\t\treturn next( onFinish );\n\t}\n\n\t/**\n\t* Callback invoked upon executing code.\n\t*\n\t* @private\n\t* @param {(Error|null)} error - error object\n\t* @param {NonNegativeIntegerArray} time - results\n\t* @returns {void}\n\t*/\n\tfunction onFinish( error, time ) {\n\t\tif ( error ) {\n\t\t\treturn done( error );\n\t\t}\n\t\tresults[ idx ] = time;\n\t\tidx += 1;\n\t\tif ( idx < opts.repeats ) {\n\t\t\treturn next( onFinish );\n\t\t}\n\t\tdone( null, results );\n\t}\n\n\t/**\n\t* Callback invoked upon completion.\n\t*\n\t* @private\n\t* @param {(Error|null)} error - error object\n\t* @param {ArrayArray} results - raw results\n\t*/\n\tfunction done( error, results ) {\n\t\tvar out;\n\t\tif ( !error ) {\n\t\t\tout = transform( results, opts.iterations );\n\t\t}\n\t\t// Avoid releasing the zalgo:\n\t\tnextTick( onTick );\n\n\t\t/**\n\t\t* Callback invoked upon the next tick.\n\t\t*\n\t\t* @private\n\t\t* @returns {void}\n\t\t*/\n\t\tfunction onTick() {\n\t\t\tif ( error ) {\n\t\t\t\treturn cb( error );\n\t\t\t}\n\t\t\tcb( null, out );\n\t\t}\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = timeit;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n/**\n* Time a snippet.\n*\n* @module @stdlib/utils-timeit\n*\n* @example\n* var timeit = require( '@stdlib/utils-timeit' );\n*\n* var code = '';\n* code += 'var x = Math.pow( Math.random(), 3 );';\n* code += 'if ( x !== x ) {';\n* code += 'throw new Error( \\'Something went wrong.\\' );';\n* code += '}';\n*\n* timeit( code, done );\n*\n* function done( error, results ) {\n*     if ( error ) {\n*         throw error;\n*     }\n*     console.dir( results );\n* }\n*/\n\n// MODULES //\n\nvar timeit = require( './timeit.js' );\n\n\n// EXPORTS //\n\nmodule.exports = timeit;\n"],"names":["isObject","require$$0","hasOwnProp","require$$1","isPositiveInteger","require$$2","isPrimitive","isString","require$$3","isBoolean","require$$4","isNull","require$$5","format","require$$6","validate_1","opts","options","iterations","repeats","TypeError","before","after","asynchronous","defineProperty","tic","toc","context_1","done","ctx","configurable","enumerable","writable","value","async","id","code","state","main","src","cb1","cb2","cb3","t","d","i","sync","vm","wrap","out","minstd","createContext","asyncSource","syncSource","compile","filename","script","lineOffset","Script","displayErrors","runInThisContext","vm_evaluate","dirname","clbk","context","call","require","Error","error","results","min","times","length","transform_1","raw","secs","rate","m","elapsed","isFunction","isArray","copy","cwd","nextTick","defaults","require$$7","validate","require$$8","evaluate","require$$9","transform","require$$10","lib","dir","err","idx","cb","arguments","Array","onTest","message","next","time","onRun","onFinish"],"mappings":"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"}